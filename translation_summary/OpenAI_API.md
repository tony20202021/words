Использование OpenAI API в проекте
Обзор
Проект теперь поддерживает использование моделей OpenAI (GPT-4, GPT-3.5-turbo) через API для перевода китайских слов. Это позволяет сравнить качество локальных моделей с передовыми облачными решениями.
Доступные OpenAI модели
МодельОписаниеРекомендуемое использованиеgpt-4oСамая мощная модель OpenAIЛучшее качество переводовgpt-4o-miniБыстрая и экономичная версия GPT-4Баланс качества и стоимостиgpt-4-turboGPT-4 Turbo (более быстрая версия)Высокое качество с хорошей скоростьюgpt-3.5-turboКлассическая модель ChatGPTЭкономичный вариант
Настройка
1. Установка зависимостей
bashpip install openai>=1.0.0
2. Получение API ключа

Зарегистрируйтесь на platform.openai.com
Создайте API ключ в разделе "API Keys"
Пополните баланс аккаунта (минимум $5)

3. Настройка переменной окружения
bash# Linux/Mac
export OPENAI_API_KEY=your_api_key_here

# Windows
set OPENAI_API_KEY=your_api_key_here

# Или создайте файл .env
echo "OPENAI_API_KEY=your_api_key_here" > .env
Использование
Запуск одной модели
bash# GPT-4o с описанием
python main_llm.py -i data.json -m gpt-4o

# GPT-4o mini без описания (экономичнее)
python main_llm.py -i data.json -m gpt-4o-mini --no-description

# GPT-3.5-turbo (самый экономичный)
python main_llm.py -i data.json -m gpt-3.5-turbo
Автоматическое тестирование всех моделей
bash# Убедитесь, что установлен OPENAI_API_KEY
export OPENAI_API_KEY=your_key

# Запуск всех моделей включая OpenAI
bash run_models.sh
Стоимость использования
Примерные цены (на май 2025)
МодельВходные токеныВыходные токеныПримерная стоимость за переводgpt-4o$0.005/1K$0.015/1K$0.001-0.003gpt-4o-mini$0.00015/1K$0.0006/1K$0.0001-0.0003gpt-4-turbo$0.01/1K$0.03/1K$0.002-0.005gpt-3.5-turbo$0.001/1K$0.002/1K$0.0002-0.0005
Расчет стоимости для 30 слов
С описанием (режим по умолчанию):

GPT-4o: ~$0.03-0.09
GPT-4o-mini: ~$0.003-0.009
GPT-3.5-turbo: ~$0.006-0.015

Без описания (режим --no-description):

GPT-4o: ~$0.01-0.03
GPT-4o-mini: ~$0.001-0.003
GPT-3.5-turbo: ~$0.002-0.006

Особенности работы с API
Автоматическое ограничение скорости

Встроенные паузы между запросами (0.1 сек)
Таймаут 30 секунд на запрос
Автоматический подсчет токенов и стоимости

Обработка ошибок

Автоматические повторы при временных сбоях
Логирование всех API вызовов
Graceful handling при исчерпании лимитов

Статистика использования
После выполнения автоматически выводится:

Количество API вызовов
Использованные токены (входные/выходные)
Примерная стоимость в USD
Средний размер запросов и ответов

Примеры логов
Успешный запуск
2025-05-23 14:30:15 - src.openai_handler - INFO - Инициализирован обработчик OpenAI для модели gpt-4o-mini
2025-05-23 14:30:16 - src.openai_handler - INFO - Начинаем пакетную обработку 30 элементов через OpenAI API
2025-05-23 14:30:45 - src.openai_handler - INFO - ==================================================
2025-05-23 14:30:45 - src.openai_handler - INFO - Статистика использования OpenAI API:
2025-05-23 14:30:45 - src.openai_handler - INFO - Модель: gpt-4o-mini
2025-05-23 14:30:45 - src.openai_handler - INFO - Всего вызовов: 30
2025-05-23 14:30:45 - src.openai_handler - INFO - Входные токены: 2450
2025-05-23 14:30:45 - src.openai_handler - INFO - Выходные токены: 180
2025-05-23 14:30:45 - src.openai_handler - INFO - Средний размер запроса: 81.7 токенов
2025-05-23 14:30:45 - src.openai_handler - INFO - Средний размер ответа: 6.0 токенов
2025-05-23 14:30:45 - src.openai_handler - INFO - Примерная стоимость: $0.0058
2025-05-23 14:30:45 - src.openai_handler - INFO - ==================================================
Сравнение результатов
Пример сравнительной таблицы
ИероглифМодельРежимПереводВремя (сек)的gpt-4oс описаниемпритяжательная частица1.2的gpt-4o-miniс описаниемчастица0.8的qwen2.5-14bс описаниемпритяжательная частица3.5我gpt-4oбез описанияя0.9我gpt-3.5-turboбез описанияя0.7
Рекомендации по использованию
Для экспериментов и разработки

gpt-4o-mini с режимом --no-description - оптимальное соотношение цена/качество

Для производственного использования

gpt-4o с описанием - лучшее качество
gpt-3.5-turbo без описания - экономичный вариант

Для сравнительного анализа

Запустите bash run_models.sh для полного сравнения
Анализируйте файл comparison.csv для детального анализа
Учитывайте стоимость при выборе модели

Ограничения и рекомендации
Rate Limits

GPT-4: до 500 запросов в минуту
GPT-3.5: до 3000 запросов в минуту
При превышении лимитов скрипт автоматически замедлится

Безопасность

Никогда не коммитьте API ключи в репозиторий
Используйте переменные окружения или .env файлы
Регулярно ротируйте API ключи

Мониторинг использования

Отслеживайте расходы в OpenAI Dashboard
Установите лимиты расходов для предотвращения неожиданных трат
Регулярно проверяйте логи на предмет ошибок

Troubleshooting
Ошибка "API key not found"
bashexport OPENAI_API_KEY=your_actual_key_here
Ошибка "Insufficient quota"

Пополните баланс аккаунта OpenAI
Проверьте лимиты использования

Ошибка "Rate limit exceeded"

Подождите несколько минут
Скрипт автоматически замедлится при следующем запуске

Ошибка "Model not found"

Проверьте правильность названия модели
Убедитесь в доступности модели для вашего аккаунта
