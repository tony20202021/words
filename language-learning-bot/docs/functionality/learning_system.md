# Система изучения слов

## Содержание
1. [Обзор системы](#обзор-системы)
2. [Настройки изучения](#настройки-изучения)
3. [Процесс изучения слов](#процесс-изучения-слов)
4. [Система интервального повторения](#система-интервального-повторения)
5. [Система подсказок](#система-подсказок)
6. [Прогресс и статистика](#прогресс-и-статистика)
7. [Технические детали](#технические-детали)
8. [Примеры использования](#примеры-использования)

## Обзор системы

Система изучения слов в Language Learning Bot основана на методе интервального повторения и включает персонализированные подсказки для улучшения запоминания. Основная цель – обеспечить эффективное изучение и запоминание иностранных слов с оптимальными интервалами повторения.

Ключевые возможности:
- Настройка процесса обучения под индивидуальные потребности
- Интервальное повторение с автоматическим расчетом интервалов
- Создание и использование персонализированных подсказок
- Отслеживание прогресса изучения
- Сохранение состояния между сессиями изучения

## Настройки изучения

Пользователь может настроить процесс изучения через команду `/settings`. Доступны следующие параметры:

### 1. Начальное слово

Параметр определяет, с какого слова в частотном списке начинать изучение.
- По умолчанию: 1 (начинать с первого слова в списке)
- Настройка: Кнопка "Изменить начальное слово" в меню настроек

### 2. Пропуск помеченных слов

Параметр определяет, будут ли показываться слова, отмеченные для пропуска.
- По умолчанию: Выключено (показывать все слова)
- Настройка: Кнопка "Пропускать помеченные слова" в меню настроек

### 3. Учет даты проверки

Параметр определяет, будет ли система учитывать дату следующей проверки при показе слов.
- По умолчанию: Включено (учитывать дату проверки)
- Настройка: Кнопка "Учитывать дату проверки" в меню настроек

### 4. Отображение подсказок

Параметр определяет, будут ли отображаться кнопки подсказок на экране изучения слов.
- По умолчанию: Включено (показывать кнопки подсказок)
- Настройка: Кнопка "Показывать подсказки" в меню настроек

## Процесс изучения слов

Процесс изучения слов запускается командой `/study` и включает следующие этапы:

### 1. Получение слов для изучения

Система запрашивает слова для изучения на основе настроек пользователя:
- Начиная с указанного начального слова
- С учетом настройки пропуска помеченных слов
- С учетом даты следующей проверки (если включена соответствующая настройка)

### 2. Отображение слова для перевода

Для каждого слова пользователю показывается:
- Перевод слова на русский язык
- Кнопка "Я знаю это слово"
- Кнопка "Не знаю слово" 
- Кнопка "Показать слово"
- Кнопки подсказок (если включена соответствующая настройка)
- Кнопка для переключения статуса пропуска слова

### 3. Действия пользователя и подсказки

#### Если пользователь знает слово:
1. Пользователь нажимает "Я знаю это слово"
2. Бот отмечает слово как известное (оценка 1)
3. Бот показывает слово на иностранном языке, его транскрипцию и информацию о следующем повторении
4. Бот предлагает кнопку "Перейти к следующему слову"

#### Если пользователь не знает слово:
1. Пользователь нажимает "Не знаю слово"
2. Бот отмечает слово как неизвестное (оценка 0)
3. Бот показывает слово на иностранном языке, его транскрипцию и информацию о следующем повторении
4. Бот предлагает кнопку "Перейти к следующему слову"

#### Если пользователь хочет увидеть слово:
1. Пользователь нажимает "Показать слово"
2. Бот показывает слово на иностранном языке и его транскрипцию
3. Бот предлагает кнопку "Следующее слово"

#### Работа с подсказками:
1. Бот отображает доступные типы подсказок:
   - Фонетическое звучание
   - Ассоциация для фонетики
   - Ассоциация для значения слова на русском
   - Ассоциация для написания
2. Пользователь может:
   - Создать новую подсказку (если она отсутствует)
   - Просмотреть существующую подсказку
   - Отредактировать существующую подсказку
3. При использовании подсказки:
   - Слово автоматически помечается как неизвестное (оценка 0)
   - Подсказка добавляется в список активных и показывается на экране изучения
   - Подсказка добавляется в список использованных

### 4. Переход к следующему слову

После выполнения одного из действий со словом, пользователь может перейти к следующему слову:
1. Нажав на кнопку "Перейти к следующему слову" (после оценки знания слова)
2. Нажав на кнопку "Следующее слово" (после просмотра слова)

При этом:
- Бот сбрасывает флаг показа слова
- Бот сбрасывает список активных подсказок
- Бот отображает следующее слово из списка

## Система интервального повторения

Система использует метод интервального повторения для оптимизации запоминания. Основные принципы:

### 1. Начальный интервал

- При первой встрече со словом интервал устанавливается в 0 дней
- При первом правильном ответе интервал устанавливается в 1 день

### 2. Увеличение интервала

При каждом успешном повторении (оценка 1) интервал увеличивается по закону степени двойки:
- 1 день → 2 дня → 4 дня → 8 дней → 16 дней → 32 дня
- Максимальный интервал (по умолчанию 32 дня) задается в конфигурации

### 3. Сброс интервала

- При неправильном ответе (оценка 0) интервал сбрасывается в 0 дней
- При использовании подсказки интервал также сбрасывается в 0 дней

### 4. Расчет даты следующей проверки

Дата следующей проверки рассчитывается по формуле:
`Дата следующей проверки = Текущая дата + Интервал (в днях)`

## Система подсказок

Система подсказок позволяет создавать персонализированные подсказки для слов, что улучшает запоминание.

### Типы подсказок

1. **Фонетика** - Разбиение слова на слоги, транскрипция по частям
2. **Ассоциация** - Ассоциативная связь с похожими по звучанию словами
3. **Значение** - Дополнительные значения, синонимы, контекст использования
4. **Написание** - Мнемонические приемы для запоминания написания (особенно полезно для иероглифов)

### Создание и редактирование подсказок

1. На экране изучения слова нажмите кнопку "Создать подсказку" нужного типа
2. Введите текст подсказки или запишите голосовое сообщение (при наличии поддержки)
3. Подсказка будет сохранена и сразу отображена на экране изучения слова
4. Также будет обновлена клавиатура, чтобы отразить наличие подсказки

Для редактирования существующей подсказки:
1. Нажмите на кнопку "Редактировать подсказку" нужного типа
2. Введите новый текст подсказки или запишите новое голосовое сообщение
3. Подсказка будет обновлена и сразу отображена на экране изучения слова

### Использование подсказок

1. На экране изучения слова нажмите кнопку "Посмотреть подсказку" нужного типа
2. Система покажет сохраненную подсказку и добавит её в список активных подсказок
3. Подсказка будет отображаться непосредственно на экране изучения слова
4. Слово автоматически отмечается оценкой 0, что приведет к сбросу интервала повторения

### Отображение подсказок

Активные подсказки отображаются непосредственно на экране изучения слова, а не в отдельном сообщении. Это позволяет пользователю видеть все необходимые подсказки сразу, не переключаясь между сообщениями.

## Прогресс и статистика

Система отслеживает прогресс изучения слов и предоставляет подробную статистику.

### Отслеживаемые показатели

1. **Общий прогресс по языку**:
   - Общее количество слов в языке
   - Количество изученных слов
   - Количество известных слов (с оценкой 1)
   - Процент изученных слов от общего количества

2. **Данные по каждому слову**:
   - Текущая оценка (0 или 1)
   - Интервал повторения (в днях)
   - Дата следующей проверки
   - Наличие подсказок
   - Статус пропуска

### Просмотр статистики

Для просмотра статистики используйте команду `/stats`:
```
/stats
```

Статистика показывает:
- Выбранный язык изучения
- Общий прогресс по языку в процентах
- Количество изученных/известных слов
- Дату последнего изучения
- График прогресса (если доступен)

## Технические детали

### Модели данных

Для работы системы изучения слов используются следующие модели данных:

#### 1. UserWordState (состояние слова)

```python
class UserWordState:
    def __init__(self):
        self.word_id = None          # ID слова
        self.word_data = {}          # Данные слова
        self.user_id = None          # ID пользователя
        self.language_id = None      # ID языка
        self.current_study_index = 0  # Текущий индекс в списке слов
        self.flags = {}              # Флаги состояния (word_shown, active_hints, used_hints, и т.д.)
        self.study_words = []        # Список слов для изучения
        self.study_settings = {}     # Настройки процесса изучения
```

#### 2. HintState (состояние подсказки)

```python
class HintState:
    def __init__(self):
        self.hint_key = None         # Ключ подсказки
        self.hint_name = None        # Название подсказки
        self.hint_word_id = None     # ID слова
        self.current_hint_text = None # Текущий текст подсказки (для редактирования)
```

### Основные функции

1. **ensure_user_word_data** - Создание или обновление данных слова в базе данных
2. **update_word_score** - Обновление оценки и расчет интервалов
3. **get_hint_text** - Получение текста подсказки
4. **get_user_language_settings** - Получение настроек пользователя для языка
5. **show_study_word** - Отображение слова для изучения
6. **format_active_hints** - Форматирование активных подсказок для отображения

### Алгоритм получения слов для изучения

Для получения слов для изучения используется API-метод `get_study_words`, который применяет следующую логику:

1. Получение базового списка слов, начиная с заданного номера
2. Фильтрация слов по статусу пропуска (если включено)
3. Фильтрация слов по дате следующей проверки (если включено)
4. Добавление пользовательских данных к каждому слову (если есть)

```python
params = {
    "start_word": settings.get("start_word", 1),
    "skip_marked": settings.get("skip_marked", False),
    "use_check_date": settings.get("use_check_date", True)
}

words_response = await api_client.get_study_words(
    user_id=user_id, 
    language_id=language_id, 
    params=params,
    limit=50
)
```

### Процесс подтверждения перехода к следующему слову

После оценки слова (как известного или неизвестного) система не переходит автоматически к следующему слову, а требует подтверждения от пользователя:

1. Пользователь нажимает кнопку "Я знаю это слово" или "Не знаю слово"
2. Система обновляет оценку слова и сохраняет её в базе данных
3. Система отображает слово на иностранном языке и кнопку "Перейти к следующему слову"
4. Только после нажатия на кнопку "Перейти к следующему слову" система переходит к следующему слову

Этот подход имеет следующие преимущества:
- Пользователь может более внимательно изучить слово перед переходом к следующему
- Все сообщения с оценкой слова и переводом сохраняются в истории чата
- Пользователь имеет больше контроля над процессом изучения

## Примеры использования

### Пример 1: Начало изучения с определенного слова

1. Отправьте команду `/settings`
2. Нажмите кнопку "Изменить начальное слово"
3. Введите номер слова, с которого хотите начать (например, "10")
4. Отправьте команду `/study`
5. Система начнет показывать слова, начиная с указанного номера

### Пример 2: Создание подсказки

1. Отправьте команду `/study` для начала изучения
2. При отображении слова нажмите кнопку "Ассоциация для значения" (или другой тип подсказки)
3. Введите текст ассоциативной подсказки (например, "похоже на русское слово...")
4. Подсказка будет сохранена и сразу отображена на экране изучения слова

### Пример 3: Использование интервального повторения

1. Отправьте команду `/study` для начала изучения
2. Для слов, которые вы знаете, нажимайте "Я знаю это слово"
3. Для слов, которые вы не знаете, нажимайте "Не знаю слово" или используйте подсказки
4. Слова с оценкой 1 будут показываться через увеличивающиеся интервалы времени
5. Слова с оценкой 0 будут показываться при каждом сеансе изучения

### Пример 4: Пропуск сложных слов

1. Отправьте команду `/settings`
2. Включите настройку "Пропускать помеченные слова"
3. Во время изучения для сложных слов нажимайте кнопку "Флаг: сменить на "Пропускать""
4. При следующем сеансе изучения помеченные слова не будут показываться

### Пример 5: Использование кнопки подтверждения перехода

1. Отправьте команду `/study` для начала изучения
2. Нажмите кнопку "Я знаю это слово" для оценки слова
3. Изучите слово, его транскрипцию и перевод
4. Нажмите кнопку "Перейти к следующему слову", когда будете готовы продолжить
5. Система покажет следующее слово для изучения